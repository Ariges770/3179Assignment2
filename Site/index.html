<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Australian Retail & Labour Market Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="json/spec1.js"></script>
    <script src="json/spec2.js"></script>
    <script src="json/spec3.js"></script>
    <script src="json/spec4.js"></script>
    <script src="json/spec5.js"></script>
    <script src="json/spec6.js"></script>
    <script src="json/spec7.js"></script>
    <script src="json/spec8.js"></script>
    <script src="json/spec9.js"></script>
    <script src="json/test_multi.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Australian Retail Trade & Labour Market Analysis</h1>
        <p class="subtitle">Visualizing retail turnover trends (1982-2025) and employment indicators across states and regions</p>
    </header>

    <main>
        <!-- Row 1: Retail Turnover Timeline -->
        <section class="viz-section full-width">
            <h2>Retail Turnover by State Over Time on Log Scale</h2>
            <div id="viz1"></div>
        </section>

        <!-- Row 2: YoY Growth + Industry Multiples -->
        <section class="viz-section half-width">
            <h2>Year-over-Year Growth Rate</h2>
            <div id="viz2"></div>
        </section>

        <section class="viz-section half-width">
            <h2>Average Monthly Turnover by State</h2>
            <div id="viz4"></div>
        </section>

        <!-- Row 6: Australia Unemployment Choropleth Map -->
        <section class="viz-section full-width">
            <h2>Australia SA4 Unemployment Rate Map (June 2025)</h2>
            <div id="viz9"></div>
        </section>

        <!-- Row 5: Top 15 Industries in Australia -->
        <section class="viz-section full-width">
            <h2>Top 15 Industries by Turnover in Australia (June 2025)</h2>
            <div id="viz8"></div>
        </section>
    




        <!-- Use heatmap for this concept -->
        <!-- <section class="viz-section half-width">
            <h2>Top Industries by State</h2>
            <div id="viz3"></div>
        </section> -->


        <!-- Row 4: Rating Distribution + Scatter -->
        <section class="viz-section half-width">
            <h2>Retail Turnover vs Unemployment Rate</h2>
            <div id="viz7"></div>
        </section>


    </main>

    <!-- <footer>
        <p>Data sources: Australian Bureau of Statistics</p>
    </footer> -->

    <script>
        // Embed all visualizations
        vegaEmbed('#viz1', spec1, {actions: false});
        vegaEmbed('#viz2', spec2, {actions: false});
        vegaEmbed('#viz4', spec4, {actions: false});
        vegaEmbed('#viz7', spec7, {actions: false});
        
        // Create parameter links between map and charts
        const paramLinks = {};
        
        vegaEmbed('#viz9', spec9, {actions: false}).then(function(result) {
            // Move parameter controls to bottom after embedding
            const vizContainer = document.getElementById('viz9');
            const bindContainer = vizContainer.querySelector('.vega-bind');
            if (bindContainer) {
                bindContainer.style.position = 'relative';
                bindContainer.style.order = '2';
                bindContainer.style.marginTop = '1rem';
                bindContainer.style.display = 'flex';
                bindContainer.style.justifyContent = 'center';
                vizContainer.style.display = 'flex';
                vizContainer.style.flexDirection = 'column';
                const chartContainer = vizContainer.querySelector('.vega-embed');
                if (chartContainer) {
                    chartContainer.style.order = '1';
                }
            }
            
            // Store reference to map view for parameter linking
            paramLinks.mapView = result.view;
            
            // Now that map is loaded, set up parameter linking for industries chart
            if (paramLinks.industriesView) {
                // Listen for changes in the map's zoomLevel parameter
                paramLinks.mapView.addSignalListener('zoomLevel', function(name, value) {
                    // Update the industries chart with the new zoom level value
                    paramLinks.industriesView.signal('zoomLevel', value).run();
                });
            }
        });
        
        vegaEmbed('#viz8', spec8, {actions: false}).then(function(result) {
            console.log('Industries chart loaded successfully');
            // Store reference to industries chart view
            paramLinks.industriesView = result.view;

            // Set up parameter linking for industries chart (if map is already loaded)
            if (paramLinks.mapView) {
                // Listen for changes in the map's zoomLevel parameter
                paramLinks.mapView.addSignalListener('zoomLevel', function(name, value) {
                    // Update the industries chart with the new zoom level value
                    paramLinks.industriesView.signal('zoomLevel', value).run();
                });
            }
        }).catch(function(error) {
            console.error('Error loading industries chart:', error);
        });
    </script>
</body>
</html>
